<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quill Bullet HTML Output Tests</title>
  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.snow.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/quill-table-better@1/dist/quill-table-better.css" rel="stylesheet">
  <style>
    :root {
      --color-pass: #22c55e;
      --color-fail: #ef4444;
      --color-pending: #f59e0b;
      --color-bg: #0f172a;
      --color-card: #1e293b;
      --color-text: #e2e8f0;
      --color-muted: #94a3b8;
      --color-border: #334155;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'SF Mono', 'Fira Code', 'Monaco', monospace;
      background: var(--color-bg);
      color: var(--color-text);
      margin: 0;
      padding: 24px;
      line-height: 1.6;
    }
    
    h1 {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 8px 0;
      color: white;
    }
    
    .subtitle {
      color: var(--color-muted);
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    .summary {
      display: flex;
      gap: 24px;
      margin-bottom: 24px;
      padding: 16px;
      background: var(--color-card);
      border-radius: 8px;
      border: 1px solid var(--color-border);
    }
    
    .summary-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .summary-count {
      font-size: 24px;
      font-weight: 700;
    }
    
    .summary-label {
      font-size: 12px;
      color: var(--color-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .pass { color: var(--color-pass); }
    .fail { color: var(--color-fail); }
    .pending { color: var(--color-pending); }
    
    .test-group {
      background: var(--color-card);
      border-radius: 8px;
      border: 1px solid var(--color-border);
      margin-bottom: 16px;
      overflow: hidden;
    }
    
    .test-group-header {
      padding: 12px 16px;
      background: rgba(0,0,0,0.2);
      border-bottom: 1px solid var(--color-border);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .test-case {
      padding: 12px 16px;
      border-bottom: 1px solid var(--color-border);
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    
    .test-case:last-child {
      border-bottom: none;
    }
    
    .test-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 12px;
    }
    
    .test-icon.pass {
      background: rgba(34, 197, 94, 0.2);
    }
    
    .test-icon.fail {
      background: rgba(239, 68, 68, 0.2);
    }
    
    .test-content {
      flex: 1;
    }
    
    .test-name {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .test-details {
      font-size: 12px;
      color: var(--color-muted);
    }
    
    .test-error {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 4px;
      padding: 8px 12px;
      margin-top: 8px;
      font-size: 12px;
      color: var(--color-fail);
    }
    
    .code-block {
      background: rgba(0,0,0,0.3);
      border-radius: 4px;
      padding: 8px 12px;
      margin-top: 8px;
      font-size: 11px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .code-label {
      font-size: 10px;
      color: var(--color-muted);
      text-transform: uppercase;
      margin-bottom: 4px;
    }
    
    /* Hidden Quill editor for testing */
    #test-editor-container {
      position: absolute;
      left: -9999px;
      top: -9999px;
      width: 800px;
      height: 600px;
    }
    
    .run-btn {
      background: linear-gradient(135deg, #3b82f6, #8b5cf6);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      margin-bottom: 24px;
    }
    
    .run-btn:hover {
      opacity: 0.9;
    }
    
    .run-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>üß™ Quill Bullet HTML Output Tests</h1>
  <p class="subtitle">Testing expected HTML structure for bullet and numbered lists</p>
  
  <button class="run-btn" id="runTests">‚ñ∂ Run Tests</button>
  
  <div class="summary" id="summary">
    <div class="summary-item">
      <span class="summary-count pass" id="passCount">0</span>
      <span class="summary-label">Passed</span>
    </div>
    <div class="summary-item">
      <span class="summary-count fail" id="failCount">0</span>
      <span class="summary-label">Failed</span>
    </div>
    <div class="summary-item">
      <span class="summary-count" id="totalCount">0</span>
      <span class="summary-label">Total</span>
    </div>
  </div>
  
  <div id="results"></div>
  
  <!-- Hidden editor for testing -->
  <div id="test-editor-container">
    <div id="test-editor"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.0/dist/quill.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quill-table-better@1/dist/quill-table-better.js"></script>
  <script>
    // Test runner
    const results = {
      passed: 0,
      failed: 0,
      tests: []
    };
    
    let editor;
    
    // Initialize Quill editor
    function initEditor() {
      if (editor) return editor;
      
      // Register table-better module if available
      if (window.QuillTableBetter) {
        try {
          Quill.register({
            'modules/table-better': window.QuillTableBetter
          }, true);
        } catch (e) {
          console.warn('Failed to register table-better:', e);
        }
      }
      
      editor = new Quill('#test-editor', {
        theme: 'snow',
        modules: {
          toolbar: false
        }
      });
      
      return editor;
    }
    
    // Test utility functions
    function normalizeHtml(html) {
      // Remove extra whitespace and normalize
      return html
        .replace(/\s+/g, ' ')
        .replace(/>\s+</g, '><')
        .trim();
    }
    
    function htmlContains(actual, expected) {
      const normalizedActual = normalizeHtml(actual);
      const normalizedExpected = normalizeHtml(expected);
      return normalizedActual.includes(normalizedExpected);
    }
    
    function htmlMatches(actual, pattern) {
      const normalizedActual = normalizeHtml(actual);
      return pattern.test(normalizedActual);
    }
    
    // Test definitions
    const testGroups = [
      {
        name: 'Bullet List Structure',
        tests: [
          {
            name: 'Should create unordered list for bullet items',
            run: () => {
              editor.setContents([
                { insert: 'Item 1' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Item 2' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              // Check for <ul> tag
              if (!html.includes('<ul>')) {
                throw new Error('Expected <ul> tag not found');
              }
              
              // Check for <li> tags
              if (!html.includes('<li')) {
                throw new Error('Expected <li> tags not found');
              }
              
              return { html };
            }
          },
          {
            name: 'Should have data-list="bullet" attribute on list items',
            run: () => {
              editor.setContents([
                { insert: 'Bullet item' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('data-list="bullet"')) {
                throw new Error('Expected data-list="bullet" attribute not found');
              }
              
              return { html };
            }
          },
          {
            name: 'Should preserve bullet item text content',
            run: () => {
              editor.setContents([
                { insert: 'Test bullet content' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('Test bullet content')) {
                throw new Error('Bullet item text content not preserved');
              }
              
              return { html };
            }
          },
          {
            name: 'Should create multiple bullet items in same list',
            run: () => {
              editor.setContents([
                { insert: 'First item' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Second item' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Third item' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              // Count <li> tags
              const liCount = (html.match(/<li/g) || []).length;
              if (liCount !== 3) {
                throw new Error(`Expected 3 <li> tags, found ${liCount}`);
              }
              
              return { html, liCount };
            }
          }
        ]
      },
      {
        name: 'Ordered List Structure',
        tests: [
          {
            name: 'Should create ordered list for numbered items',
            run: () => {
              editor.setContents([
                { insert: 'Item 1' },
                { insert: '\n', attributes: { list: 'ordered' } },
                { insert: 'Item 2' },
                { insert: '\n', attributes: { list: 'ordered' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('<ol>')) {
                throw new Error('Expected <ol> tag not found');
              }
              
              return { html };
            }
          },
          {
            name: 'Should have data-list="ordered" attribute on list items',
            run: () => {
              editor.setContents([
                { insert: 'Numbered item' },
                { insert: '\n', attributes: { list: 'ordered' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('data-list="ordered"')) {
                throw new Error('Expected data-list="ordered" attribute not found');
              }
              
              return { html };
            }
          }
        ]
      },
      {
        name: 'Nested Lists',
        tests: [
          {
            name: 'Should support indented bullet items',
            run: () => {
              editor.setContents([
                { insert: 'Parent item' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Nested item' },
                { insert: '\n', attributes: { list: 'bullet', indent: 1 } }
              ]);
              const html = editor.root.innerHTML;
              
              // Check for indent class
              if (!html.includes('ql-indent-1')) {
                throw new Error('Expected ql-indent-1 class not found for nested item');
              }
              
              return { html };
            }
          },
          {
            name: 'Should support multiple indent levels',
            run: () => {
              editor.setContents([
                { insert: 'Level 0' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Level 1' },
                { insert: '\n', attributes: { list: 'bullet', indent: 1 } },
                { insert: 'Level 2' },
                { insert: '\n', attributes: { list: 'bullet', indent: 2 } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('ql-indent-1')) {
                throw new Error('Expected ql-indent-1 class not found');
              }
              if (!html.includes('ql-indent-2')) {
                throw new Error('Expected ql-indent-2 class not found');
              }
              
              return { html };
            }
          }
        ]
      },
      {
        name: 'Mixed Lists',
        tests: [
          {
            name: 'Should handle bullet followed by ordered list',
            run: () => {
              editor.setContents([
                { insert: 'Bullet item' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Ordered item' },
                { insert: '\n', attributes: { list: 'ordered' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('<ul>') || !html.includes('<ol>')) {
                throw new Error('Expected both <ul> and <ol> tags');
              }
              
              return { html };
            }
          },
          {
            name: 'Should separate different list types',
            run: () => {
              editor.setContents([
                { insert: 'Bullet 1' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Bullet 2' },
                { insert: '\n', attributes: { list: 'bullet' } },
                { insert: 'Normal paragraph' },
                { insert: '\n' },
                { insert: 'Ordered 1' },
                { insert: '\n', attributes: { list: 'ordered' } }
              ]);
              const html = editor.root.innerHTML;
              
              // Check separate list elements exist
              const ulCount = (html.match(/<ul>/g) || []).length;
              const olCount = (html.match(/<ol>/g) || []).length;
              
              if (ulCount < 1 || olCount < 1) {
                throw new Error(`Expected at least 1 <ul> and 1 <ol>. Found: ${ulCount} <ul>, ${olCount} <ol>`);
              }
              
              return { html, ulCount, olCount };
            }
          }
        ]
      },
      {
        name: 'Formatted List Items',
        tests: [
          {
            name: 'Should preserve bold formatting in list items',
            run: () => {
              editor.setContents([
                { insert: 'Normal ' },
                { insert: 'bold', attributes: { bold: true } },
                { insert: ' text' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('<strong>bold</strong>')) {
                throw new Error('Bold formatting not preserved in list item');
              }
              
              return { html };
            }
          },
          {
            name: 'Should preserve italic formatting in list items',
            run: () => {
              editor.setContents([
                { insert: 'Normal ' },
                { insert: 'italic', attributes: { italic: true } },
                { insert: ' text' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('<em>italic</em>')) {
                throw new Error('Italic formatting not preserved in list item');
              }
              
              return { html };
            }
          },
          {
            name: 'Should preserve links in list items',
            run: () => {
              editor.setContents([
                { insert: 'Click ' },
                { insert: 'here', attributes: { link: 'https://example.com' } },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('href="https://example.com"')) {
                throw new Error('Link not preserved in list item');
              }
              
              return { html };
            }
          }
        ]
      },
      {
        name: 'List Checklist Items',
        tests: [
          {
            name: 'Should create checklist items',
            run: () => {
              editor.setContents([
                { insert: 'Unchecked task' },
                { insert: '\n', attributes: { list: 'unchecked' } },
                { insert: 'Checked task' },
                { insert: '\n', attributes: { list: 'checked' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('data-list="unchecked"')) {
                throw new Error('Expected data-list="unchecked" attribute not found');
              }
              if (!html.includes('data-list="checked"')) {
                throw new Error('Expected data-list="checked" attribute not found');
              }
              
              return { html };
            }
          }
        ]
      },
      {
        name: 'Empty List Items',
        tests: [
          {
            name: 'Should handle empty bullet items',
            run: () => {
              editor.setContents([
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              const html = editor.root.innerHTML;
              
              if (!html.includes('<li')) {
                throw new Error('Expected <li> tag for empty bullet item');
              }
              
              return { html };
            }
          }
        ]
      },
      {
        name: 'List to Paragraph Conversion',
        tests: [
          {
            name: 'Should convert list item back to paragraph',
            run: () => {
              // First create a list
              editor.setContents([
                { insert: 'List item' },
                { insert: '\n', attributes: { list: 'bullet' } }
              ]);
              
              // Then remove list formatting
              editor.setContents([
                { insert: 'Regular paragraph' },
                { insert: '\n' }
              ]);
              
              const html = editor.root.innerHTML;
              
              if (html.includes('<ul>') || html.includes('<ol>')) {
                throw new Error('List tags should not exist after conversion to paragraph');
              }
              
              if (!html.includes('<p>')) {
                throw new Error('Expected <p> tag for regular paragraph');
              }
              
              return { html };
            }
          }
        ]
      }
    ];
    
    // Run tests and display results
    function runTests() {
      const resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = '';
      results.passed = 0;
      results.failed = 0;
      results.tests = [];
      
      initEditor();
      
      testGroups.forEach(group => {
        const groupEl = document.createElement('div');
        groupEl.className = 'test-group';
        
        let groupPassed = 0;
        let groupFailed = 0;
        
        const testsHtml = group.tests.map(test => {
          let status = 'pass';
          let error = null;
          let details = null;
          
          try {
            details = test.run();
            groupPassed++;
            results.passed++;
          } catch (e) {
            status = 'fail';
            error = e.message;
            groupFailed++;
            results.failed++;
          }
          
          const icon = status === 'pass' ? '‚úì' : '‚úó';
          
          return `
            <div class="test-case">
              <div class="test-icon ${status}">${icon}</div>
              <div class="test-content">
                <div class="test-name">${test.name}</div>
                ${error ? `<div class="test-error">${error}</div>` : ''}
                ${details?.html ? `
                  <div class="code-block">
                    <div class="code-label">Generated HTML:</div>
                    ${escapeHtml(details.html)}
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        }).join('');
        
        const statusIcon = groupFailed === 0 ? '‚úì' : '‚úó';
        const statusClass = groupFailed === 0 ? 'pass' : 'fail';
        
        groupEl.innerHTML = `
          <div class="test-group-header">
            <span class="${statusClass}">${statusIcon}</span>
            ${group.name}
            <span class="test-details">(${groupPassed}/${group.tests.length} passed)</span>
          </div>
          ${testsHtml}
        `;
        
        resultsContainer.appendChild(groupEl);
      });
      
      // Update summary
      document.getElementById('passCount').textContent = results.passed;
      document.getElementById('failCount').textContent = results.failed;
      document.getElementById('totalCount').textContent = results.passed + results.failed;
      
      // Log results to console for automation
      console.log(`\n========== TEST RESULTS ==========`);
      console.log(`‚úÖ Passed: ${results.passed}`);
      console.log(`‚ùå Failed: ${results.failed}`);
      console.log(`üìä Total: ${results.passed + results.failed}`);
      console.log(`==================================\n`);
    }
    
    function escapeHtml(html) {
      return html
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
    
    // Event listeners
    document.getElementById('runTests').addEventListener('click', () => {
      const btn = document.getElementById('runTests');
      btn.disabled = true;
      btn.textContent = '‚è≥ Running...';
      
      setTimeout(() => {
        runTests();
        btn.disabled = false;
        btn.textContent = '‚ñ∂ Run Tests';
      }, 100);
    });
    
    // Auto-run tests on load
    window.addEventListener('load', () => {
      setTimeout(runTests, 500);
    });
  </script>
</body>
</html>

